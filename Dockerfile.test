# Dockerfile per eseguire i test
FROM node:20-alpine

# Installa git (necessario per alcune dipendenze npm)
RUN apk add --no-cache git

# Imposta la directory di lavoro
WORKDIR /usr/src/app

# Copia i file di configurazione
COPY package*.json ./
COPY jest.config.json ./
COPY jest.integration.config.json ./

# Installa TUTTE le dipendenze (inclusi devDependencies per i test)
RUN npm install

# Copia tutto il codice sorgente
COPY . .

# Crea la directory per i report di test
RUN mkdir -p /usr/src/app/test-reports

# Espone la porta per eventuali server di test
EXPOSE 3000

# Default command per eseguire i test
CMD ["npm", "run", "test:integration"]